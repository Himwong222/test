<!DOCTYPE html>

<html lang="zh-TW"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Churn Risk Assessment Dashboard - Tea Observation</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6b8f24",
                        "background-light": "#f7f8f6",
                        "background-dark": "#1b1f13",
                    },
                    fontFamily: {
                        "display": ["Work Sans", "Noto Sans TC", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        body { font-family: 'Work Sans', sans-serif; }
        .bg-tea-texture {
            background-color: #f7f8f6;
            background-image: radial-gradient(#6b8f2411 0.5px, transparent 0.5px);
            background-size: 24px 24px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display min-h-screen flex flex-col">
<!-- Top Navigation Bar -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary/10 bg-white dark:bg-background-dark px-10 py-3 sticky top-0 z-50">
<div class="flex items-center gap-4 text-primary">
<div class="size-8">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-slate-900 dark:text-slate-100 text-lg font-bold leading-tight tracking-tight">Tea Observation Churn Risk Assessor</h2>
</div>
<div class="flex flex-1 justify-end gap-8 items-center">
<button id="mobile-menu-toggle" class="md:hidden p-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
<span class="material-symbols-outlined text-[20px]">menu</span>
</button>
<nav class="hidden md:flex items-center gap-9">
<a class="text-primary text-sm font-semibold border-b-2 border-primary pb-1" href="#">Dashboard</a>
<a class="text-slate-600 dark:text-slate-400 text-sm font-medium hover:text-primary transition-colors" href="../customer_list.html">Customer List</a>
<a class="text-slate-600 dark:text-slate-400 text-sm font-medium hover:text-primary transition-colors" href="../reports.html">Reports</a>
<a class="text-slate-600 dark:text-slate-400 text-sm font-medium hover:text-primary transition-colors" href="../settings.html">Settings</a>
</nav>
<div class="h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center overflow-hidden border border-primary/30">
<img class="w-full h-full object-cover" data-alt="Manager profile photo avatar" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB3d8m8dPDzV7Y5d1-uypWlkxkS-RvhCyStxYmPi91OYaogS2Ct5oWNN9kU91Ze4sHPA2owB96TZ9WQRz3dFvm13e-dohWxRG7RIdFcmxHycBiM_6TX2LKe9gIojrPazuUiQeyNALd4LLiimQH1RaZPNyIOAuGcxpzRbKaV90PZnbUaHss4o7BD9KeHkghrBOIZ5J-ZZCqdn4mJrWFV-D88P2CGsu9a1koNlDkuupHxc8mcSE7tqn8jQxz32BXrzVjJXEfVT_nzDt4"/>
</div>
</div>

<!-- Mobile Menu Drawer -->
<div id="mobile-menu" class="fixed inset-0 bg-black/50 z-50 hidden md:hidden">
<div class="absolute right-0 top-0 h-full w-64 bg-white dark:bg-background-dark shadow-xl">
<div class="p-4 border-b border-primary/10 flex justify-between items-center">
<h3 class="text-lg font-bold text-primary">Navigation</h3>
<button id="close-mobile-menu" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800">
<span class="material-symbols-outlined">close</span>
</button>
</div>
<div class="p-4 space-y-4">
<a class="block py-3 px-4 rounded-lg bg-primary/10 text-primary font-semibold" href="#">Dashboard</a>
<a class="block py-3 px-4 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300" href="../customer_list.html">Customer List</a>
<a class="block py-3 px-4 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300" href="../reports.html">Reports</a>
<a class="block py-3 px-4 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300" href="../settings.html">Settings</a>
<a class="block py-3 px-4 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-300" href="../index.html">Home</a>
</div>
</div>
</div>
</header>
<!-- Main Content Layout -->
<main class="flex flex-col md:flex-row flex-1 overflow-hidden h-[calc(100vh-65px)]">
<!-- Left Sidebar: Input Form -->
<aside class="w-full md:w-[400px] border-r border-primary/10 bg-white/50 dark:bg-background-dark/50 overflow-y-auto p-4 md:p-6 scrollbar-hide">
<div class="flex flex-col gap-6">
<div>
<h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Customer Profile</h1>
<p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Input demographic and behavioral data</p>
</div>
<!-- Form Card -->
<div class="bg-primary/5 dark:bg-primary/10 rounded-xl p-6 border border-primary/10 flex flex-col gap-5">
<!-- Age Input -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300">Age / 年齡</label>
<input id="age-input" class="w-full rounded-lg border-primary/20 bg-white dark:bg-background-dark focus:ring-primary focus:border-primary text-slate-900 dark:text-slate-100" placeholder="e.g. 28" type="number" min="1" max="120"/>
</div>
<!-- Monthly Visits -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300">Monthly Visits / 每月造訪次數</label>
<input id="visits-input" class="w-full rounded-lg border-primary/20 bg-white dark:bg-background-dark focus:ring-primary focus:border-primary text-slate-900 dark:text-slate-100" placeholder="e.g. 12" type="number" min="0" max="100"/>
</div>
<!-- Days Since Last Visit -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300">Days Since Last Visit / 距上次造訪天數</label>
<input id="days-input" class="w-full rounded-lg border-primary/20 bg-white dark:bg-background-dark focus:ring-primary focus:border-primary text-slate-900 dark:text-slate-100" placeholder="e.g. 45" type="number" min="0" max="365"/>
</div>
<!-- Satisfaction Score -->
<div class="flex flex-col gap-2">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300">Satisfaction Score / 滿意度評分</label>
<div class="flex gap-2 items-center">
<button class="w-10 h-10 rounded-lg border border-primary/30 bg-primary/20 text-primary flex items-center justify-center font-bold satisfaction-btn" data-score="1">1</button>
<button class="w-10 h-10 rounded-lg border border-primary/30 bg-primary text-white flex items-center justify-center font-bold satisfaction-btn" data-score="2">2</button>
<button class="w-10 h-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-background-dark flex items-center justify-center font-bold text-slate-400 satisfaction-btn" data-score="3">3</button>
<button class="w-10 h-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-background-dark flex items-center justify-center font-bold text-slate-400 satisfaction-btn" data-score="4">4</button>
<button class="w-10 h-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-background-dark flex items-center justify-center font-bold text-slate-400 satisfaction-btn" data-score="5">5</button>
<input type="hidden" id="satisfaction-input" value="2">
</div>
</div>
<!-- Action Buttons -->
<div class="flex flex-col gap-3 pt-4">
<button id="assess-btn" class="w-full py-3 bg-primary hover:bg-primary/90 text-white rounded-lg font-bold shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-[20px]">analytics</span>
                            評估風險
                        </button>
<button class="w-full py-3 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-lg font-semibold transition-all">
                            重設
                        </button>
</div>
</div>
<!-- Secondary Info Card -->
<div class="p-4 rounded-xl border border-dashed border-primary/30 bg-primary/5">
<div class="flex items-start gap-3">
<span class="material-symbols-outlined text-primary">info</span>
<p class="text-xs text-slate-600 dark:text-slate-400 leading-relaxed">
                            Predictions are based on historic behavioral patterns of active tea club members over the last 12 months.
                        </p>
</div>
</div>
</div>
</aside>
<!-- Right Panel: Results Section -->
<section class="flex-1 bg-tea-texture overflow-y-auto p-4 md:p-8 lg:p-12 relative">
<!-- Result Visibility Wrapper (Visible State) -->
<div class="max-w-4xl mx-auto flex flex-col gap-6 md:gap-10">
<!-- Results Header -->
<div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
<div>
<h2 class="text-3xl font-black text-slate-900 dark:text-slate-100 tracking-tight">Assessment Results</h2>
<p class="text-slate-500 dark:text-slate-400 mt-2">Analysis for Customer ID: #TEA-88219</p>
</div>
<div class="flex items-center gap-3">
<button id="export-pdf-btn" class="flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-background-dark text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-50">
<span class="material-symbols-outlined text-[18px]">download</span> Export PDF
                        </button>
<button class="flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-background-dark text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-50">
<span class="material-symbols-outlined text-[18px]">share</span> Share
                        </button>
</div>
</div>
<!-- Risk Level Indicators -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- Probability Card -->
<div class="bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-sm border border-primary/5 flex flex-col items-center justify-center text-center group">
<h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Churn Probability</h3>
<div class="relative flex items-center justify-center">
<!-- Circular Progress Simulation -->
<svg class="w-48 h-48 transform -rotate-90">
<circle class="text-slate-100 dark:text-slate-800" cx="96" cy="96" fill="transparent" r="88" stroke="currentColor" stroke-width="12"></circle>
<circle id="probability-circle" class="text-rose-500" cx="96" cy="96" fill="transparent" r="88" stroke="currentColor" stroke-dasharray="552.92" stroke-dashoffset="110.58" stroke-width="12"></circle>
</svg>
<div class="absolute inset-0 flex flex-col items-center justify-center">
<span id="probability-value" class="text-5xl font-black text-slate-900 dark:text-slate-100">80%</span>
<span id="risk-level-text" class="text-rose-500 font-bold text-sm">CRITICAL</span>
</div>
</div>
</div>
<!-- Risk Rating Card -->
<div class="bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-sm border border-primary/5 flex flex-col gap-6">
<h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest">Risk Classification</h3>
<div class="flex flex-col gap-4">
<!-- High Risk Bar -->
<div id="risk-level-indicator" class="flex items-center justify-between p-4 rounded-xl bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-900/30">
<div class="flex items-center gap-3">
<div class="size-3 rounded-full bg-rose-500 animate-pulse"></div>
<span id="risk-level-title" class="text-rose-700 dark:text-rose-400 font-bold">High Risk Level</span>
</div>
<span class="material-symbols-outlined text-rose-500">warning</span>
</div>
<p id="risk-description" class="text-slate-600 dark:text-slate-400 text-sm leading-relaxed">
                                This customer shows patterns typical of churned users: <br/>
<span class="font-bold text-slate-800 dark:text-slate-200">• Low satisfaction score (2/5)</span><br/>
<span class="font-bold text-slate-800 dark:text-slate-200">• Long period of inactivity (45 days)</span>
</p>
</div>
<div class="mt-auto pt-6 border-t border-slate-100 dark:border-slate-800">
<div class="flex items-center justify-between text-xs text-slate-500">
<span>Confidence Score</span>
<span class="font-bold">94.2%</span>
</div>
<div class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full mt-2 overflow-hidden">
<div class="h-full bg-primary w-[94%]"></div>
</div>
</div>
</div>
</div>
<!-- Action Recommendations -->
<div class="bg-white dark:bg-slate-900 p-8 rounded-2xl shadow-sm border border-primary/5">
<div class="flex items-center gap-3 mb-8">
    <div class="size-10 rounded-lg bg-primary/10 text-primary flex items-center justify-center">
        <span class="material-symbols-outlined">lightbulb</span>
    </div>
    <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">Retention Strategy</h3>
</div>

<!-- Retention Decision Recommendation -->
<div id="retention-decision" class="mb-8 p-6 rounded-xl border border-slate-200 dark:border-slate-700 bg-gradient-to-r from-primary/5 to-primary/10">
    <div class="flex items-start gap-4">
        <div class="size-12 rounded-full bg-white dark:bg-slate-800 shadow-sm flex items-center justify-center text-primary">
            <span class="material-symbols-outlined text-[24px]">decision</span>
        </div>
        <div class="flex-1">
            <h4 class="font-bold text-lg text-slate-900 dark:text-slate-100 mb-2">客戶保留建議</h4>
            <p id="retention-decision-text" class="text-slate-700 dark:text-slate-300">
                根據流失風險評估，系統將提供是否應該保留此客戶的建議。
            </p>
            <div id="retention-reason" class="mt-3 text-sm text-slate-600 dark:text-slate-400">
                <!-- Reasons will be populated by JavaScript -->
            </div>
        </div>
        <div id="retention-badge" class="px-4 py-2 rounded-full bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 text-sm font-medium">
            等待評估
        </div>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<!-- Recommendation 1 -->
<div class="p-5 rounded-xl border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/40 transition-all cursor-pointer group">
<div class="flex items-start gap-4">
<div class="size-10 rounded-full bg-white dark:bg-slate-700 shadow-sm flex items-center justify-center text-primary">
<span class="material-symbols-outlined text-[20px]">local_offer</span>
</div>
<div class="flex-1">
<h4 class="font-bold text-slate-800 dark:text-slate-200 group-hover:text-primary">Send "We Miss You" Coupon</h4>
<p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Offer a 20% discount on their favorite Oolong tea to encourage a return visit.</p>
</div>
<span class="material-symbols-outlined text-slate-300">chevron_right</span>
</div>
</div>
<!-- Recommendation 2 -->
<div class="p-5 rounded-xl border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/40 transition-all cursor-pointer group">
<div class="flex items-start gap-4">
<div class="size-10 rounded-full bg-white dark:bg-slate-700 shadow-sm flex items-center justify-center text-amber-500">
<span class="material-symbols-outlined text-[20px]">chat_bubble</span>
</div>
<div class="flex-1">
<h4 class="font-bold text-slate-800 dark:text-slate-200 group-hover:text-primary">Satisfaction Survey</h4>
<p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Directly call or email to understand the reason for the low satisfaction score.</p>
</div>
<span class="material-symbols-outlined text-slate-300">chevron_right</span>
</div>
</div>
<!-- Recommendation 3 -->
<div class="p-5 rounded-xl border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/40 transition-all cursor-pointer group">
<div class="flex items-start gap-4">
<div class="size-10 rounded-full bg-white dark:bg-slate-700 shadow-sm flex items-center justify-center text-blue-500">
<span class="material-symbols-outlined text-[20px]">card_giftcard</span>
</div>
<div class="flex-1">
<h4 class="font-bold text-slate-800 dark:text-slate-200 group-hover:text-primary">Free Tasting Invitation</h4>
<p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Invite to a private seasonal tea tasting event next Friday.</p>
</div>
<span class="material-symbols-outlined text-slate-300">chevron_right</span>
</div>
</div>
<!-- Recommendation 4 -->
<div class="p-5 rounded-xl border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/40 transition-all cursor-pointer group">
<div class="flex items-start gap-4">
<div class="size-10 rounded-full bg-white dark:bg-slate-700 shadow-sm flex items-center justify-center text-primary">
<span class="material-symbols-outlined text-[20px]">stars</span>
</div>
<div class="flex-1">
<h4 class="font-bold text-slate-800 dark:text-slate-200 group-hover:text-primary">Tier Upgrade Promotion</h4>
<p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Notify them they are only 1 purchase away from Gold Membership rewards.</p>
</div>
<span class="material-symbols-outlined text-slate-300">chevron_right</span>
</div>
</div>
</div>
</div>
</div>
<!-- Empty State / Placeholder (Optional overlay if no data is present) -->
<!-- Uncomment to see empty state -->
<!-- 
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-tea-texture z-10 p-12 text-center">
                <div class="size-24 bg-primary/10 text-primary rounded-full flex items-center justify-center mb-6">
                    <span class="material-symbols-outlined text-[48px]">pending_actions</span>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200">Ready for Assessment</h2>
                <p class="text-slate-500 max-w-md mt-2 leading-relaxed">Please fill out the customer profile on the left and click "評估風險" to generate a detailed churn risk analysis and retention plan.</p>
                <div class="mt-8 grid grid-cols-3 gap-8 opacity-20 grayscale">
                    <div class="w-32 h-20 bg-primary/20 rounded-lg"></div>
                    <div class="w-32 h-20 bg-primary/20 rounded-lg"></div>
                    <div class="w-32 h-20 bg-primary/20 rounded-lg"></div>
                </div>
            </div> 
            -->
</section>
</main>
<!-- Background Decoration -->
<div class="fixed bottom-0 right-0 p-8 pointer-events-none opacity-5 dark:opacity-10">
<svg class="w-64 h-64 text-primary" fill="currentColor" viewbox="0 0 100 100">
<path d="M50 0 C 70 30 100 40 100 60 C 100 80 80 100 50 100 C 20 100 0 80 0 60 C 0 40 30 30 50 0"></path>
</svg>
</div>

    <!-- JavaScript for Churn Risk Assessment and Mobile Menu -->
    <script>
        // Mobile Menu Functionality
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMobileMenu = document.getElementById('close-mobile-menu');
        
        if (mobileMenuToggle && mobileMenu && closeMobileMenu) {
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.remove('hidden');
            });
            
            closeMobileMenu.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
            
            // Close menu when clicking outside
            mobileMenu.addEventListener('click', (e) => {
                if (e.target === mobileMenu) {
                    mobileMenu.classList.add('hidden');
                }
            });
            
            // Close menu when clicking on a link
            document.querySelectorAll('#mobile-menu a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });
        }
        
        // Mobile-specific optimizations
        document.addEventListener('DOMContentLoaded', () => {
            // Increase touch target sizes on mobile
            if ('ontouchstart' in window || navigator.maxTouchPoints) {
                document.querySelectorAll('button, a').forEach(element => {
                    element.classList.add('min-h-[44px]', 'min-w-[44px]');
                });
                
                // Make form inputs more touch-friendly
                document.querySelectorAll('input, select, textarea').forEach(input => {
                    input.classList.add('text-base', 'py-3');
                });
                
                // Adjust sidebar height on mobile
                const sidebar = document.querySelector('aside');
                if (sidebar && window.innerWidth < 768) {
                    sidebar.style.maxHeight = '60vh';
                    sidebar.style.overflowY = 'auto';
                }
            }
        });
        
        // Satisfaction score buttons
        const satisfactionButtons = document.querySelectorAll('.satisfaction-btn');
        const satisfactionInput = document.getElementById('satisfaction-input');
        const assessBtn = document.getElementById('assess-btn');
        
        // Set initial satisfaction score (2)
        let selectedScore = 2;
        
        // Update satisfaction button styles
        function updateSatisfactionButtons(score) {
            satisfactionButtons.forEach(btn => {
                const btnScore = parseInt(btn.getAttribute('data-score'));
                if (btnScore === score) {
                    btn.classList.add('bg-primary', 'text-white');
                    btn.classList.remove('bg-primary/20', 'text-primary', 'bg-white', 'dark:bg-background-dark', 'text-slate-400');
                    btn.classList.remove('border-slate-200', 'dark:border-slate-700');
                    btn.classList.add('border-primary/30');
                } else if (btnScore === 1) {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('bg-primary/20', 'text-primary');
                    btn.classList.add('border-primary/30');
                } else {
                    btn.classList.remove('bg-primary', 'text-white', 'bg-primary/20', 'text-primary');
                    btn.classList.add('bg-white', 'dark:bg-background-dark', 'text-slate-400');
                    btn.classList.add('border-slate-200', 'dark:border-slate-700');
                }
            });
            satisfactionInput.value = score;
            selectedScore = score;
        }
        
        // Initialize satisfaction buttons
        satisfactionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const score = parseInt(btn.getAttribute('data-score'));
                updateSatisfactionButtons(score);
            });
        });
        
        // Calculate churn risk based on PRD algorithm
        function calculateChurnRisk(age, visits, days, satisfaction) {
            // Base probability from overall churn rate
            let probability = 28.5; // 28.5% base churn rate
            
            // Apply rules from PRD section 4.1 and 4.2
            // 1. Days Since Last Visit (65.6% importance)
            if (days > 60) {
                probability += 16.7; // High risk: 45.2% - 28.5% = 16.7%
            } else if (days >= 30 && days <= 60) {
                probability += 8.5; // Medium risk
            }
            
            // 2. Satisfaction Score (18.2% importance)
            if (satisfaction <= 2) {
                probability += 14.4; // High risk: 42.9% - 28.5% = 14.4%
            } else if (satisfaction === 3) {
                probability += 6.5; // Medium risk
            }
            
            // 3. Monthly Visits (10.1% importance)
            if (visits <= 3) {
                probability += 10.2; // High risk: 38.7% - 28.5% = 10.2%
            } else if (visits >= 4 && visits <= 6) {
                probability += 4.5; // Medium risk
            }
            
            // 4. Age (6.1% importance) - minor adjustment
            if (age < 25 || age > 60) {
                probability += 3.0; // Slightly higher risk for younger/older customers
            }
            
            // Cap probability between 5% and 95%
            probability = Math.max(5, Math.min(95, probability));
            
            // Determine risk level
            let riskLevel, riskColor, riskText;
            if (probability >= 60) {
                riskLevel = 'HIGH';
                riskColor = 'rose';
                riskText = 'High Risk Level';
            } else if (probability >= 40) {
                riskLevel = 'MEDIUM';
                riskColor = 'amber';
                riskText = 'Medium Risk Level';
            } else {
                riskLevel = 'LOW';
                riskColor = 'emerald';
                riskText = 'Low Risk Level';
            }
            
            return {
                probability: Math.round(probability),
                riskLevel,
                riskColor,
                riskText
            };
        }
        
        // Update UI with results
        function updateResults(age, visits, days, satisfaction, results) {
            // Update probability circle
            const circle = document.getElementById('probability-circle');
            const circumference = 2 * Math.PI * 88; // 2πr
            const offset = circumference - (results.probability / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Update probability value
            document.getElementById('probability-value').textContent = `${results.probability}%`;
            
            // Update risk level text
            document.getElementById('risk-level-text').textContent = results.riskLevel;
            document.getElementById('risk-level-text').className = `text-${results.riskColor}-500 font-bold text-sm`;
            
            // Update risk level indicator
            const indicator = document.getElementById('risk-level-indicator');
            indicator.className = `flex items-center justify-between p-4 rounded-xl bg-${results.riskColor}-50 dark:bg-${results.riskColor}-900/20 border border-${results.riskColor}-200 dark:border-${results.riskColor}-900/30`;
            
            // Update risk level title
            document.getElementById('risk-level-title').textContent = results.riskText;
            document.getElementById('risk-level-title').className = `text-${results.riskColor}-700 dark:text-${results.riskColor}-400 font-bold`;
            
            // Update risk description
            let description = `This customer shows `;
            if (results.riskLevel === 'HIGH') {
                description += `patterns typical of churned users: <br/>`;
            } else if (results.riskLevel === 'MEDIUM') {
                description += `some concerning patterns: <br/>`;
            } else {
                description += `generally positive patterns: <br/>`;
            }
            
            // Add specific factors
            const factors = [];
            if (days > 60) factors.push(`• Long period of inactivity (${days} days)`);
            if (days >= 30 && days <= 60) factors.push(`• Moderate period of inactivity (${days} days)`);
            if (satisfaction <= 2) factors.push(`• Low satisfaction score (${satisfaction}/5)`);
            if (satisfaction === 3) factors.push(`• Average satisfaction score (${satisfaction}/5)`);
            if (satisfaction >= 4) factors.push(`• Good satisfaction score (${satisfaction}/5)`);
            if (visits <= 3) factors.push(`• Low visit frequency (${visits} times/month)`);
            if (visits >= 4 && visits <= 6) factors.push(`• Moderate visit frequency (${visits} times/month)`);
            if (visits > 6) factors.push(`• High visit frequency (${visits} times/month)`);
            
            description += factors.slice(0, 3).join('<br/>');
            document.getElementById('risk-description').innerHTML = description;
            
            // Update retention decision recommendation
            updateRetentionDecision(results, age, visits, days, satisfaction);
        }
        
        // Update retention decision based on churn risk
        function updateRetentionDecision(results, age, visits, days, satisfaction) {
            const decisionElement = document.getElementById('retention-decision-text');
            const reasonElement = document.getElementById('retention-reason');
            const badgeElement = document.getElementById('retention-badge');
            
            let decision = '';
            let reason = '';
            let badgeText = '';
            let badgeColor = '';
            
            // Decision logic based on churn probability
            if (results.probability >= 60) {
                // High risk: Consider letting go or aggressive retention
                decision = '建議：考慮放棄或採取積極保留措施';
                badgeText = '高風險客戶';
                badgeColor = 'bg-rose-100 text-rose-800 border-rose-300 dark:bg-rose-900/30 dark:text-rose-300 dark:border-rose-700';
                
                reason = `
                    <div class="space-y-2">
                        <p class="font-medium">原因分析：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>流失機率高達 ${results.probability}%，超過警戒線</li>
                            <li>保留成本可能高於客戶終身價值</li>
                            <li>建議優先處理其他中低風險客戶</li>
                        </ul>
                        <p class="mt-2 font-medium">行動建議：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>若客戶價值高，可嘗試最後一次優惠挽留</li>
                            <li>否則建議資源重新分配至更有價值客戶</li>
                            <li>記錄流失原因供未來產品改進參考</li>
                        </ul>
                    </div>
                `;
            } else if (results.probability >= 40) {
                // Medium risk: Worth retaining with targeted efforts
                decision = '建議：值得保留，需採取針對性措施';
                badgeText = '中等風險客戶';
                badgeColor = 'bg-amber-100 text-amber-800 border-amber-300 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-700';
                
                reason = `
                    <div class="space-y-2">
                        <p class="font-medium">原因分析：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>流失機率為 ${results.probability}%，處於中等風險範圍</li>
                            <li>客戶仍有相當價值，值得投入資源保留</li>
                            <li>關鍵因素：${getKeyRiskFactors(days, satisfaction, visits)}</li>
                        </ul>
                        <p class="mt-2 font-medium">行動建議：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>實施右側建議的保留策略</li>
                            <li>定期追蹤改善情況（建議每2週一次）</li>
                            <li>考慮提供個性化優惠或服務</li>
                        </ul>
                    </div>
                `;
            } else {
                // Low risk: Definitely retain
                decision = '建議：強烈建議保留，維持良好關係';
                badgeText = '低風險客戶';
                badgeColor = 'bg-emerald-100 text-emerald-800 border-emerald-300 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-700';
                
                reason = `
                    <div class="space-y-2">
                        <p class="font-medium">原因分析：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>流失機率僅 ${results.probability}%，屬於低風險客戶</li>
                            <li>客戶忠誠度高，具有長期價值</li>
                            <li>關鍵優勢：${getKeyPositiveFactors(days, satisfaction, visits)}</li>
                        </ul>
                        <p class="mt-2 font-medium">行動建議：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>維持現有服務品質，避免過度打擾</li>
                            <li>考慮升級為VIP客戶或提供忠誠度獎勵</li>
                            <li>定期收集反饋以進一步提升滿意度</li>
                        </ul>
                    </div>
                `;
            }
            
            // Update decision text
            decisionElement.textContent = decision;
            
            // Update reason HTML
            reasonElement.innerHTML = reason;
            
            // Update badge
            badgeElement.textContent = badgeText;
            badgeElement.className = `px-4 py-2 rounded-full border text-sm font-medium ${badgeColor}`;
            
            // Update decision card background based on risk level
            const decisionCard = document.getElementById('retention-decision');
            if (results.probability >= 60) {
                decisionCard.className = 'mb-8 p-6 rounded-xl border border-rose-200 dark:border-rose-800 bg-gradient-to-r from-rose-50 to-rose-100 dark:from-rose-900/20 dark:to-rose-800/20';
            } else if (results.probability >= 40) {
                decisionCard.className = 'mb-8 p-6 rounded-xl border border-amber-200 dark:border-amber-800 bg-gradient-to-r from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20';
            } else {
                decisionCard.className = 'mb-8 p-6 rounded-xl border border-emerald-200 dark:border-emerald-800 bg-gradient-to-r from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20';
            }
        }
        
        // Helper function to get key risk factors
        function getKeyRiskFactors(days, satisfaction, visits) {
            const factors = [];
            if (days > 60) factors.push('長時間未訪問');
            if (days >= 30 && days <= 60) factors.push('中等時間未訪問');
            if (satisfaction <= 2) factors.push('低滿意度');
            if (satisfaction === 3) factors.push('中等滿意度');
            if (visits <= 3) factors.push('低訪問頻率');
            if (visits >= 4 && visits <= 6) factors.push('中等訪問頻率');
            return factors.slice(0, 2).join('、');
        }
        
        // Helper function to get key positive factors
        function getKeyPositiveFactors(days, satisfaction, visits) {
            const factors = [];
            if (days <= 30) factors.push('近期有訪問');
            if (satisfaction >= 4) factors.push('高滿意度');
            if (visits > 6) factors.push('高訪問頻率');
            return factors.length > 0 ? factors.join('、') : '穩定的客戶行為';
        }
        
        // Handle assess button click
        assessBtn.addEventListener('click', () => {
            // Get input values
            const age = parseInt(document.getElementById('age-input').value) || 30;
            const visits = parseInt(document.getElementById('visits-input').value) || 5;
            const days = parseInt(document.getElementById('days-input').value) || 30;
            const satisfaction = parseInt(satisfactionInput.value) || 3;
            
            // Calculate churn risk
            const results = calculateChurnRisk(age, visits, days, satisfaction);
            
            // Update UI
            updateResults(age, visits, days, satisfaction, results);
            
            // Scroll to results section
            document.querySelector('main section:nth-child(2)').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Initialize with default values
        updateSatisfactionButtons(2);
        
        // PDF Export functionality
        const exportPdfBtn = document.getElementById('export-pdf-btn');
        
        exportPdfBtn.addEventListener('click', () => {
            // Get current input values
            const age = parseInt(document.getElementById('age-input').value) || 30;
            const visits = parseInt(document.getElementById('visits-input').value) || 5;
            const days = parseInt(document.getElementById('days-input').value) || 30;
            const satisfaction = parseInt(satisfactionInput.value) || 3;
            
            // Calculate churn risk for PDF
            const results = calculateChurnRisk(age, visits, days, satisfaction);
            
            // Create a temporary element for PDF generation
            const pdfElement = document.createElement('div');
            pdfElement.style.padding = '20px';
            pdfElement.style.backgroundColor = 'white';
            pdfElement.style.color = 'black';
            pdfElement.style.fontFamily = "'Work Sans', 'Noto Sans TC', sans-serif";
            
            // Get current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Build PDF content
            pdfElement.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style="color: #6b8f24; font-size: 24px; margin-bottom: 5px;">Churn Risk Assessment Report</h1>
                    <h2 style="color: #6b8f24; font-size: 18px; margin-bottom: 5px;">茶言觀色·客戶流失風險評估器</h2>
                    <p style="color: #666; font-size: 14px;">Generated on ${dateStr}</p>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                    <h3 style="color: #333; font-size: 18px; margin-bottom: 15px;">Customer Profile</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #eee; width: 40%;"><strong>Age:</strong></td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">${age} years</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Monthly Visits:</strong></td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">${visits} times</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Days Since Last Visit:</strong></td>
                            <td style="padding: 8px; border-bottom: 1px solid #eee;">${days} days</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px;"><strong>Satisfaction Score:</strong></td>
                            <td style="padding: 8px;">${satisfaction}/5</td>
                        </tr>
                    </table>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                    <h3 style="color: #333; font-size: 18px; margin-bottom: 15px;">Risk Assessment Results</h3>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 20px;">
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 36px; font-weight: bold; color: ${results.riskLevel === 'HIGH' ? '#dc2626' : results.riskLevel === 'MEDIUM' ? '#d97706' : '#059669'};">
                                ${results.probability}%
                            </div>
                            <div style="font-size: 14px; color: #666;">Churn Probability</div>
                        </div>
                        <div style="flex: 2; padding-left: 20px;">
                            <div style="padding: 10px 15px; background-color: ${results.riskLevel === 'HIGH' ? '#fef2f2' : results.riskLevel === 'MEDIUM' ? '#fffbeb' : '#f0fdf4'};
                                        border: 1px solid ${results.riskLevel === 'HIGH' ? '#fecaca' : results.riskLevel === 'MEDIUM' ? '#fde68a' : '#bbf7d0'};
                                        border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: ${results.riskLevel === 'HIGH' ? '#dc2626' : results.riskLevel === 'MEDIUM' ? '#d97706' : '#059669'};">${results.riskText}</strong>
                            </div>
                            <p style="color: #555; font-size: 14px; line-height: 1.5;">
                                ${document.getElementById('risk-description').textContent.replace(/•/g, '•')}
                            </p>
                        </div>
                    </div>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #333; font-size: 18px; margin-bottom: 15px;">Recommendations</h3>
                    <ul style="color: #555; font-size: 14px; line-height: 1.6; padding-left: 20px;">
                        <li>Monitor customer engagement and consider proactive outreach</li>
                        <li>Review satisfaction feedback and address any service issues</li>
                        <li>Consider personalized offers based on visit frequency patterns</li>
                        <li>Schedule follow-up assessments after implementing retention strategies</li>
                    </ul>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; font-size: 12px;">
                    <p>茶言觀色·客戶流失風險評估器 v1.0 • Based on data analysis of 7,892 customer samples</p>
                    <p>Overall churn rate: 28.5% • Model confidence: 94.2%</p>
                </div>
            `;
            
            // Generate PDF
            const options = {
                margin: [10, 10, 10, 10],
                filename: `Churn_Risk_Assessment_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    logging: false
                },
                jsPDF: {
                    unit: 'mm',
                    format: 'a4',
                    orientation: 'portrait'
                }
            };
            
            // Show loading state
            const originalText = exportPdfBtn.innerHTML;
            exportPdfBtn.innerHTML = '<span class="material-symbols-outlined text-[18px]">hourglass_empty</span> Generating PDF...';
            exportPdfBtn.disabled = true;
            
            // Generate and download PDF
            html2pdf().set(options).from(pdfElement).save().then(() => {
                // Restore button state
                exportPdfBtn.innerHTML = originalText;
                exportPdfBtn.disabled = false;
                
                // Show success message
                alert('PDF report has been generated and downloaded successfully!');
            }).catch(err => {
                // Restore button state
                exportPdfBtn.innerHTML = originalText;
                exportPdfBtn.disabled = false;
                
                // Show error message
                alert('Error generating PDF. Please try again.');
                console.error('PDF generation error:', err);
            });
        });
    </script>
</body></html>